<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#05070d" />
    <title>BestShot · Terminal Darkroom</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="shell">
      <aside class="panel panel--left">
        <div class="brand">
          <p class="brand-kicker">bestshot</p>
          <h1>Darkroom</h1>
          <p class="brand-copy">Drop, rank, and file your selects in a dockerized studio.</p>
        </div>
        <div class="panel-section">
          <div class="panel-head">
            <h2>Projects</h2>
            <button id="refresh-projects" class="text-button" aria-label="Reload projects">
              ↺ refresh
            </button>
          </div>
          <div id="all-projects-option" class="all-projects-option">
            <h3>All Projects</h3>
            <small>View all media</small>
          </div>
          <ul id="projects-list" class="projects"></ul>
        </div>
        <form id="new-project-form" class="panel-form">
          <label for="project-name">Create project</label>
          <input
            type="text"
            id="project-name"
            name="project-name"
            placeholder="night-run-01"
            autocomplete="off"
            required
          />
          <textarea
            id="project-description-input"
            name="project-description"
            placeholder='Optional note (e.g. "Portrait set B")'
            rows="2"
          ></textarea>
          <button type="submit" class="primary">Spin up</button>
        </form>
      </aside>

      <section class="panel panel--right">
        <header class="workspace-header">
          <div>
            <p class="eyebrow">project</p>
            <div class="workspace-title-row">
              <h2 id="workspace-title">Select a project</h2>
              <button id="edit-project-name" class="edit-name-btn" title="Rename project" hidden>✎</button>
            </div>
            <p id="workspace-meta" class="muted"></p>
          </div>
          <div class="workspace-actions">
            <div class="search-box">
              <input type="text" id="search-input" placeholder="Search by name or tag..." autocomplete="off" />
              <button id="clear-search" class="search-clear" hidden aria-label="Clear search">&times;</button>
            </div>
            <button id="start-compare" class="ghost">Compare</button>
            <div class="media-filter" role="group" aria-label="Media filter">
              <button class="toggle active" data-media-filter="all">Both</button>
              <button class="toggle" data-media-filter="photos">Photos</button>
              <button class="toggle" data-media-filter="videos">Videos</button>
            </div>
            <div class="upload-actions">
              <input type="file" id="file-input" multiple hidden accept="image/jpeg,image/png,image/gif,image/bmp,image/tiff,image/webp,image/heic,video/mp4,video/quicktime,video/x-msvideo,video/x-matroska,video/webm,video/x-m4v,video/x-ms-wmv,video/x-flv,video/3gpp,.jpg,.jpeg,.png,.gif,.bmp,.tif,.tiff,.webp,.heic,.mp4,.mov,.avi,.mkv,.webm,.m4v,.wmv,.flv,.3gp" />
              <button id="browse-files" class="ghost" disabled>Browse</button>
              <button id="download-all" class="ghost" disabled>Download All</button>
              <button id="delete-project" class="ghost danger" disabled>Delete</button>
            </div>
          </div>
        </header>

        <section class="project-note">
          <form id="project-description-form">
            <label for="project-description">Description</label>
            <textarea
              id="project-description"
              placeholder="Leave a short note for this set"
              rows="3"
              disabled
            ></textarea>
            <div class="note-actions">
              <small id="project-description-status" class="muted">Idle</small>
              <button id="save-description" class="ghost" disabled>Save note</button>
            </div>
          </form>
        </section>

        <section class="canvas" id="gallery-drop-zone">
          <div id="drop-overlay" class="drop-overlay" hidden>
            <p id="drop-overlay-text">Drop files to add to gallery</p>
            <small id="drop-overlay-subtext">New items will be marked as "Unranked"</small>
          </div>
          <div id="images-grid" class="images-grid"></div>
        </section>
      </section>
    </div>

    <template id="image-card-template">
      <div class="image-card" draggable="true">
        <div class="image-card__head">
          <span class="rank-pill"></span>
          <span class="drag-handle" title="Drag to reorder">⋮⋮</span>
          <p class="filename"></p>
          <button class="download-media-btn" aria-label="Download photo" title="Download photo">↓</button>
          <button class="delete-media-btn" aria-label="Delete photo" title="Delete photo">&times;</button>
        </div>
        <img alt="" loading="lazy" />
        <div class="image-card__tags">
          <div class="tags-list"></div>
          <div class="tag-input-wrapper" hidden>
            <input type="text" class="tag-input" placeholder="Add tag..." />
          </div>
          <button class="add-tag-btn" aria-label="Add tag">+ tag</button>
        </div>
      </div>
    </template>

    <template id="video-card-template">
      <div class="image-card video-card" draggable="true">
        <div class="image-card__head">
          <span class="rank-pill"></span>
          <span class="drag-handle" title="Drag to reorder">⋮⋮</span>
          <p class="filename"></p>
          <button class="download-media-btn" aria-label="Download video" title="Download video">↓</button>
          <button class="delete-media-btn" aria-label="Delete video" title="Delete video">&times;</button>
        </div>
        <div class="video-thumbnail">
          <video muted preload="metadata"></video>
          <button class="play-button" aria-label="Play video">
            <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
        </div>
        <div class="image-card__tags">
          <div class="tags-list"></div>
          <div class="tag-input-wrapper" hidden>
            <input type="text" class="tag-input" placeholder="Add tag..." />
          </div>
          <button class="add-tag-btn" aria-label="Add tag">+ tag</button>
        </div>
      </div>
    </template>

    <!-- Video Player Modal -->
    <div id="video-modal" class="video-modal" hidden>
      <div class="video-modal__backdrop"></div>
      <div class="video-modal__content">
        <button class="video-modal__close" aria-label="Close video">&times;</button>
        <video id="modal-video" controls autoplay></video>
        <p id="modal-video-name" class="video-modal__name"></p>
      </div>
    </div>

    <!-- Fullscreen Media Viewer Modal (for Gallery mode) -->
    <div id="media-viewer-modal" class="media-viewer-modal" hidden>
      <div class="media-viewer-modal__backdrop"></div>
      <div class="media-viewer-modal__content">
        <button class="media-viewer-modal__close" aria-label="Close viewer">&times;</button>
        <button class="media-viewer-modal__nav media-viewer-modal__prev" aria-label="Previous">&#8249;</button>
        <button class="media-viewer-modal__nav media-viewer-modal__next" aria-label="Next">&#8250;</button>
        <div class="media-viewer-modal__media">
          <img id="viewer-image" alt="" />
          <video id="viewer-video" controls></video>
        </div>
        <div class="media-viewer-modal__info">
          <p id="viewer-filename" class="media-viewer-modal__name"></p>
          <div class="media-viewer-modal__actions">
            <button id="viewer-download-btn" class="ghost viewer-download-btn">
              <span class="download-icon">↓</span> Download
            </button>
          </div>
          <div class="media-viewer-modal__tags">
            <div id="viewer-tags-list" class="tags-list"></div>
            <div id="viewer-tag-input-wrapper" class="tag-input-wrapper" hidden>
              <input type="text" id="viewer-tag-input" class="tag-input" placeholder="Add tag..." />
            </div>
            <button id="viewer-add-tag-btn" class="add-tag-btn" aria-label="Add tag">+ tag</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Comparison Mode Selection Modal -->
    <div id="comparison-selection" class="comparison-selection" hidden>
      <div class="comparison-selection__backdrop"></div>
      <div class="comparison-selection__content">
        <h3>Start Comparison</h3>
        <p>Choose which items to compare and rank</p>
        <div class="comparison-selection__options">
          <button id="compare-all" class="comparison-option">
            <span class="comparison-option__title">All Items</span>
            <span id="compare-all-count" class="comparison-option__count">0 items</span>
            <span class="comparison-option__desc">Compare and rank all media in the gallery</span>
          </button>
          <button id="compare-unranked" class="comparison-option">
            <span class="comparison-option__title">New Items Only</span>
            <span id="compare-unranked-count" class="comparison-option__count">0 new items</span>
            <span class="comparison-option__desc">Compare new items against existing ranking to find their place</span>
          </button>
        </div>
        <div class="comparison-selection__actions">
          <button id="cancel-comparison-selection" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Comparison Mode UI -->
    <div id="comparison-mode" class="comparison-mode" hidden>
      <div class="comparison-mode__header">
        <h2>Ranking Mode</h2>
        <p id="comparison-progress" class="comparison-mode__progress">Comparison 1 of 10</p>
        <button id="exit-comparison" class="ghost">Exit</button>
      </div>
      <p class="comparison-mode__instruction">Click on the image you prefer</p>
      <div class="comparison-mode__arena">
        <div class="comparison-card" id="compare-left">
          <img alt="" />
          <video muted></video>
          <p class="comparison-card__name"></p>
        </div>
        <div class="comparison-vs">VS</div>
        <div class="comparison-card" id="compare-right">
          <img alt="" />
          <video muted></video>
          <p class="comparison-card__name"></p>
        </div>
      </div>
      <div class="comparison-mode__actions">
        <button id="comparison-skip" class="ghost">Skip (tie)</button>
      </div>
    </div>

    <!-- Comparison Results Modal -->
    <div id="comparison-results" class="comparison-results" hidden>
      <div class="comparison-results__backdrop"></div>
      <div class="comparison-results__content">
        <h2>Ranking Complete!</h2>
        <p class="comparison-results__subtitle">Your images ranked by preference</p>
        <div id="results-list" class="comparison-results__list"></div>
        <div class="comparison-results__actions">
          <button id="apply-ranking" class="primary">Apply Ranking</button>
          <button id="discard-ranking" class="ghost">Discard</button>
        </div>
      </div>
    </div>

    <!-- Rename Project Modal -->
    <div id="rename-modal" class="rename-modal" hidden>
      <div class="rename-modal__backdrop"></div>
      <div class="rename-modal__content">
        <h3>Rename Project</h3>
        <p>Enter a new name for <strong id="rename-project-current"></strong></p>
        <input type="text" id="rename-project-input" placeholder="New project name..." autocomplete="off" />
        <div class="rename-modal__actions">
          <button id="confirm-rename" class="primary">Rename</button>
          <button id="cancel-rename" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="delete-modal" hidden>
      <div class="delete-modal__backdrop"></div>
      <div class="delete-modal__content">
        <h3>Delete Project?</h3>
        <p>Are you sure you want to delete <strong id="delete-project-name"></strong>? This will remove all media files and cannot be undone.</p>
        <div class="delete-modal__actions">
          <button id="confirm-delete" class="primary danger">Delete</button>
          <button id="cancel-delete" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Project Selection Modal (for file drops in All Projects view) -->
    <div id="project-select-modal" class="project-select-modal" hidden>
      <div class="project-select-modal__backdrop"></div>
      <div class="project-select-modal__content">
        <h3>Choose a Project</h3>
        <p>Select which project to add these files to, or create a new project.</p>
        <div id="project-select-list" class="project-select-modal__list"></div>
        <div class="project-select-modal__divider">or create new</div>
        <div class="project-select-modal__new">
          <input type="text" id="project-select-new-name" placeholder="New project name..." />
          <button id="project-select-create" class="primary">Create</button>
        </div>
        <div class="project-select-modal__actions">
          <button id="project-select-cancel" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}" defer></script>
  </body>
</html>
